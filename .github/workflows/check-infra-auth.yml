name: Check GitHub Actions AWS Authentication

on:
  workflow_dispatch:
    inputs:
      app_name:
        description: the name of subdirectory of /infra that holds the application's infrastructure code
        required: true
      environment:
        description: the name of the application environment e.g. "prod" or "staging"
        required: true

permissions:
  contents: read
  id-token: write

jobs:
  caller-identity:
    name: Check caller identity
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Configure AWS credentials
        uses: ./.github/actions/configure-aws-credentials
        with:
          app_name: ${{ inputs.app_name }}
          environment: ${{ inputs.environment }}

      - run: aws sts get-caller-identity
