# Vulnerability Management for Docker Images
This repository contains a GitHub action that allows you to scan Docker images for vulnerabilities. The action, named `image-scan` is located in the directory `.github/actions/image-scan`. The goal in scanning the image before pushing it to the repository is so that you can catch any vulnerabilities before deploying the image, ECR scanning takes time and the image can still be used even with vulnerabilities found by Inspector. Also, if you use `scratch` as a base image, ECR is unable to scan the image when it is pushed, which is a known issue. Add this to be part of the PR process so that any pushes to the repo will trigger the scan

A way to ensure that there are smaller surface areas for vulnerabilities, follow this method of building images
- Build base image with required packages, name it something like `build`
- Configure app build from the image in the previous step, name it something like `app-build`
- Create a final image from `scratch` named `release` (ie `from scratch as release`), and copy any needed directories from the `app-build` image

By following this method, your deployment image will have the minimum required directories and files

## How to use the GitHub Action
To scan your Docker images, either use the example [CI pipeline](../../.github/workflows/ci-vulnerability-scans.yml), or add this template and add it to your workflow pipeline.

```
- name: Scan Dockerfile by hadolint
  uses: hadolint/hadolint-action@v3.0.0
    with:
      dockerfile: app/Dockerfile
      format: json
      failure-threshold: warning

- name: Build and tag Docker image (example)
  id: build-image
  env:
    ECR_REGISTRY: "Your ECR registry goes here"
    ECR_REPOSITORY: "Your ECR repo goes here"
    IMAGE_TAG: "The image tag goes here"
  run: |
    echo "Run build image here, tagged as below"
    echo "image=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" >> $GITHUB_OUTPUT

- name: Scan docker image
  uses: ./.github/actions/image-scan
  with:
    image: ${{ steps.build-image.outputs.image }}
```

If there are any vulnerabilities found, the action will fail and cause the workflow to fail as well.
