# Vulnerability Management for Docker Images
This repository contains a GitHub action that allows you to scan Docker images for vulnerabilities. The action, named `image-scan` is located in the directory `.github/actions/image-scan`. The goal in scanning the image before pushing it to the repository is so that you can catch any vulnerabilities before deploying the image, ECR scanning takes time and the image can still be used even with vulnerabilities found by Inspector.

A way to ensure that there are smaller surface areas for vulnerabilities, follow this method of building images
- Build base image with required packages, name it something like `build`
- Configure app build from the image in the previous step, name it something like `app-build`
- Create a final image from `scratch` named `release` (ie `from scratch as release`), and copy any needed directories from the `app-build` image

By following this method, your deployment image will have the minimum required directories and files

## How to use the GitHub Action
To scan your Docker images, use this template and add it to your workflow pipeline.

```
- name: Build and tag Docker image (example)
  id: build-image
  env:
    ECR_REGISTRY: "Your ECR registry goes here"
    ECR_REPOSITORY: "Your ECR repo goes here"
    IMAGE_TAG: "The image tag goes here"
  run: |
    echo "image=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" >> $GITHUB_OUTPUT

- name: Scan docker image
  uses: ./.github/actions/image-scan
  with:
    image: ${{ steps.build-image.outputs.image }}
```

If there are any vulnerabilities found, the action will fail and cause the workflow to fail as well.
